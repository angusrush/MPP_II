\documentclass[main.tex]{subfiles}

\begin{document}

\section{Push-pull of local systesms}
\label{sec:the_non_monoidal_construction}

For any cocomplete $\infty$-category $\category{C}$, we have constructed an $\infty$-category $\LS(\category{C})$ of local systems on $\category{C}$, together with a map $p\colon \LS(\category{C}) \to \S$. We have shown that this map is a bicartesian fibration.
\begin{itemize}
  \item As a cartesian fibration, it classifies the pullback functor $(-)^{*}\colon \S\op \to \ICat$; for any morphism $X \to Y$ in $\S$, this functoriality gives us a map
    \begin{equation*}
      \begin{tikzcd}
        f^{*}\colon \Fun(Y, \category{C}) \to \Fun(X, \category{C}).
      \end{tikzcd}
    \end{equation*}

  \item As a cocartesian fibration, it classifies the left Kan extension functor $(-)_{!}\colon \S \to \ICat$; for any morphism $X \to Y$, in $\S$, this functoriality gives us a map
    \begin{equation*}
      f_{!}\colon \Fun(X, \category{C}) \to \Fun(Y, \category{C}).
    \end{equation*}
\end{itemize}

We might wonder if we can combine these functorialities. Given a \emph{span} of morphisms in $\S$, i.e.\ a diagram in $\S$ of the form
\begin{equation}
  \label{eq:span_of_spaces}
  \begin{tikzcd}
    & Y
    \arrow[dl, swap, "g"]
    \arrow[dr, "f"]
    \\
    X
    && X'
  \end{tikzcd},
\end{equation}
we can pull back along $g$ and push forward along $f$, giving a map $f_{!} \circ g^{*}\colon \Fun(X, \category{C}) \to \Fun(X', \category{C})$ via the composition
\begin{equation*}
  \begin{tikzcd}[column sep=tiny]
    & \Fun(Y, \category{C})
    \arrow[dr, "f_{!}"]
    \\
    \Fun(X, \category{C})
    \arrow[rr, dashed, swap, "f_{!} \circ g^{*}"]
    \arrow[ur, "g^{*}"]
    && \Fun(X', \category{C})
  \end{tikzcd}.
\end{equation*}
More concretely, we would like to upgrade this construction to a functor $\hat{r}\colon \Span(\S) \to \ICat$, where $\Span(\S)$ is an $\infty$-category with the following rough description.
\begin{itemize}
  \item The objects of $\Span(\S)$ are the same as the objects of $\S$, i.e.\ spaces $X$, $Y$, etc.

  \item The morphisms from $X$ to $X'$ are given by spans in $\S$, i.e.\ diagrams of the form given in \hyperref[eq:span_of_spaces]{Equation~\ref*{eq:span_of_spaces}}.

  \item The $2$-simplices witnessing the composition of two morphisms 
    \begin{equation*}
      X \overset{h}{\leftarrow} Y \overset{f}{\rightarrow} X' \quad\text{and}\quad X' \overset{g}{\leftarrow} Y \overset{j}{\rightarrow} X''
    \end{equation*}
    are diagrams of the form
    \begin{equation}
      \label{eq:diagram_witnessing_composition}
      \begin{tikzcd}
        && Z
        \arrow[dl, swap, "g'"]
        \arrow[dr, "f'"]
        \\
        & Y
        \arrow[dl, swap, "h"]
        \arrow[dr, "f"]
        && Y'
        \arrow[dl, swap, "g"]
        \arrow[dr, "j"]
        \\
        X
        && X'
        && X''
      \end{tikzcd},
    \end{equation}
    where the square formed is pullback. The corresponding composition is then given by the span
    \begin{equation*}
      \begin{tikzcd}
        & Z
        \arrow[dl, swap, "h \circ g'"]
        \arrow[dr, "j \circ f'"]
        \\
        X
        && X''
      \end{tikzcd}.
    \end{equation*}
\end{itemize}
The non-trivial part of constructing such a functor $\hat{r}$ will be showing that it respects composition; we need that for any diagram of the form given in \hyperref[eq:diagram_witnessing_composition]{Equation~\ref*{eq:diagram_witnessing_composition}}, both ways of composing morphisms from left to right in the diagram
\begin{equation*}
  \begin{tikzcd}[column sep=tiny]
    && \Fun(Z, \category{C})
    \arrow[dr, "(f')_{!}"]
    \\
    & \Fun(Y, \category{C})
    \arrow[ur, "(g')^{*}"]
    \arrow[dr, "f_{!}"]
    && \Fun(Y', \category{C})
    \arrow[dr, "j_{!}"]
    \\
    \Fun(X, \category{C})
    \arrow[ur, "h^{*}"]
    && \Fun(X', \category{C})
    \arrow[ur, "g^{*}"]
    && \Fun(X'', \category{C})
  \end{tikzcd},
\end{equation*}
agree up to a specified natural equivalence. This condition can be distilled down to the so-called \emph{Beck-Chevalley condition:}
\begin{itemize}
  \item For any pullback square in $\S$
    \begin{equation*}
      \begin{tikzcd}
        Z
        \arrow[r, "f'"]
        \arrow[d, swap, "g'"]
        & Y'
        \arrow[d, "g"]
        \\
        Y
        \arrow[r, "f"]
        & X
      \end{tikzcd},
    \end{equation*}
    the comparison map
    \begin{equation*}
      f_{!} \circ g^{*} \overset{\eta}{\Rightarrow} f_{!} \circ g^{*} \circ (f')^{*} \circ (f')_{!} \overset{\simeq}{\Rightarrow} f_{!} \circ f^{*} \circ (g')^{*} \circ (f')_{!} \overset{\epsilon}{\Rightarrow} (g')^{*} \circ (f')_{!}
    \end{equation*}
    is an equivalence.
\end{itemize}

One can phrase the Beck-Chevalley condition at the level of fibrations rather than functors into $\ICat$. This is a classical definition, here more or less lifted from \cite{luriehopkins2013ambidexterity}.

\begin{definition}
  \label{def:beck_chevalley_fibration}
  A bicartesian fibration of quasicategories $p\colon \category{X} \to \category{T}$ such that $\category{T}$ admits pullbacks is called a \defn{Beck-Chevalley fibration} if it has the following property.
  \begin{itemize}
    \item[(BC)]\label{item:beck_chevalley_condition} For any commuting square in $\category{X}$
      \begin{equation*}
        \begin{tikzcd}
          z
          \arrow[r, "f'"]
          \arrow[d, swap, "g'"]
          & y
          \arrow[d, "g"]
          \\
          y'
          \arrow[r, "f"]
          & x
        \end{tikzcd}
      \end{equation*}
      lying over a pullback square in $\category{T}$, if the morphism $f$ is $p$-cocartesian and the morphisms $g$ and $g'$ are $p$-cartesian, then the morphism $f'$ is $p$-cocartesian.
  \end{itemize}
\end{definition}

In fact, it turns out that this condition is sufficient to guarantee that the the push-pull procedure is functorial.

\begin{proposition}
  Let $p\colon \category{X} \to \category{T}$ be a Beck-Chevalley fibration. Then there is a functor $\Span(\category{T}) \to \ICat$ sending an object $t \in \Span(\category{T})$ to the fiber $\category{X}_{t}$, and a span $t \overset{b}{\leftarrow} s \overset{a}{\rightarrow} t'$ to the composition $a_{!} \circ b^{*}\colon \category{X}_{t} \to \category{X}_{t'}$.
\end{proposition}
\begin{proof}
  It follows immediately from \hyperref[thm:new_barwick]{Theorem~\ref*{thm:new_barwick}} that there is a cocartesian fibration
  \begin{equation*}
    \tilde{p}\colon \Span^{\mathrm{cart}}(\category{X}) \to \Span(\category{T}),
  \end{equation*}
  where $\Span^{\mathrm{cart}}$ denotes the category of spans whose backwards-facing legs are constrained to be $p$-cartesian; that is, $\category{X}^{\dagger} = \category{X}^{\mathrm{cart}}$. Straightening gives the result that we want.
\end{proof}


The proof of the following proposition will come at the end of this section.

\begin{proposition}
  \label{prop:local_systems_are_beck_chevalley}
  The functor $p\colon \LS(\category{C}) \to \S$ is a Beck-Chevalley fibration.
\end{proposition}

We next prove a few lemmata which will help us in our proof.

The following is simply a reformulation of the definition of a left Kan extension (\hyperref[def:nat_xfo_exhibiting_left_kan_ext]{Definition~\ref*{def:nat_xfo_exhibiting_left_kan_ext}}) in the special case that we consider left Kan extensions along maps of Kan complexes.
\begin{lemma}
  \label{lemma:left_kan_ext_along_kan_complexes}
  Let $f\colon X \to Y$ be a map between Kan complexes, let $F\colon X \to \category{C}$ and $G\colon Y \to \category{C}$ be functors, and let $\eta\colon F \to G \circ y$ be a natural transformation. Then $\eta$ exhibits $G$ as a left Kan extension of $F$ along $f$ if and only if, for all $y \in Y$, the natural transformatin $F \circ \pi \Rightarrow \underline{G(y)}$ defined by the pasting diagram
  \begin{equation*}
    \begin{tikzcd}[row sep=large, column sep=large]
      X_{/y}
      \arrow[r, "\pi", ""{name=LA, swap}]
      \arrow[d, ""{name=LD}]
      & X
      \arrow[d, swap, "f"]
      \arrow[r, "F", ""{below, name=M}]
      & \category{C}
      \\
      \{y\}
      \arrow[r, hook, ""{name=LB}]
      & Y
      \arrow[ur, swap, "G"]
      \arrow[from=M, Rightarrow, shorten=2ex, swap, "\eta"]
    \end{tikzcd},
  \end{equation*}
  exhibits $G(y)$ as the colimit of $F \circ \pi$, where the left-hand square is homotopy pullback.
\end{lemma}
\begin{proof}
  We note that we can factor the above square into three squares
  \begin{equation*}
    \begin{tikzcd}
      X_{/y}
      \arrow[r, "\simeq"]
      \arrow[d]
      & X^{/y}
      \arrow[r]
      \arrow[d]
      & Y^{\Delta^{1}} \times_{Y} X
      \arrow[r, "\simeq"]
      \arrow[d]
      & X
      \arrow[d, "f"]
      \\
      \{y\}
      \arrow[r, equals]
      & \{y\}
      \arrow[r]
      & Y
      \arrow[r, equals]
      & Y
    \end{tikzcd},
  \end{equation*}
  where the middle square is a strict pullback. Since the map $Y^{\Delta^{1}} \times_{Y}X \to Y$ is a Kan fibration, the middle square is also a homotopy pullback. We note that the left and right squares are also homotopy pullbacks, since the horizontal morphisms are weak equivalences. Thus, the outer square is a homotopy pullback; one easily checks that the natural equivalence $f \circ \pi \Rightarrow \underline{y}$ defined by pasting the three squares agrees with the natural transformation $\alpha$ defined in \hyperref[notation:rund_um_undercategories]{Notation~\ref*{notation:rund_um_undercategories}}.
\end{proof}


\begin{proof}[Proof of Theorem \ref{prop:local_systems_are_beck_chevalley}]
  We have already shown that $p$ is a bicartesian fibration, and we know that $\S$ admits pullbacks. Therefore, it suffices to show that $p$ has \hyperref[item:beck_chevalley_condition]{Property~(BC)}.

  We consider a square $\sigma\colon \Delta^{1} \times \Delta^{1} \cong \Delta^{\{0,1,2\}} \amalg_{\Delta^{\{0,2\}}}\Delta^{\{0,1',2\}} \to \LS(\category{C})$ with the following properties.
  \begin{enumerate}
    \item The restriction $\sigma|\Delta^{\{0,1\}}$ is $p$-cartesian.

    \item The restriction $\sigma|\Delta^{\{1',2\}}$ is $p$-cartesian.

    \item The restriction $\sigma|\Delta^{\{1,2\}}$ is $p$-cocartesian.

    \item The square $\sigma$ lies over a pullback square
      \begin{equation*}
        p(\sigma) =
        \begin{tikzcd}
          X_{0}
          \arrow[r, "f'"]
          \arrow[d, swap, "g'"]
          & X_{1'}
          \arrow[d, "g"]
          \\
          X_{1}
          \arrow[r, "f"]
          & X_{2}
        \end{tikzcd}
      \end{equation*}
      in $\S$.
  \end{enumerate}
  We need to show that $\sigma|\Delta^{\{0,1'\}}$ is $p$-cocartesian.

  The map $\sigma$ adjunct to a map
  \begin{equation*}
    \tau\colon \Delta^{\{0,1,2,\overline{2}, \overline{1}, \overline{0}\}}_{\dagger}\amalg_{\Delta^{\{0,2,\overline{2}, \overline{0}\}}_{\dagger}} \Delta^{\{0,1',2,\overline{2}, \overline{1}', \overline{0}\}}_{\dagger} \to \ICCat
  \end{equation*}
  such that $\tau|\Delta^{\{\overline{2}, \overline{1}, \overline{0}\}} \amalg_{\Delta^{\{\overline{2},\overline{0}\}}} \Delta^{\{\overline{2}, \overline{1}', \overline{0}\}}$ is the constant functor with value $\category{C}$. We can read off the following further properties of $\tau$, corresponding to the properties of $\sigma$ above.
  \begin{enumerate}
    \item The simplices $\tau|\Delta^{\{0,1,\overline{0}\}}$ and $\tau|\Delta^{\{0,\overline{1},\overline{0}\}}$ are thin.

    \item The simplices $\tau|\Delta^{\{1',2,\overline{1}'\}}$ and $\tau|\Delta^{\{1',\overline{2},\overline{1}'\}}$ are thin.

    \item The simplex $\tau|\Delta^{\{1,2,\overline{1}\}}$ is left Kan.

    \item The restriction $\tau|\Delta^{\{0,1,2\}} \amalg_{\Delta^{\{0,2\}}}\Delta^{\{0,1',2\}}$ is equal to $p(\sigma)$.
  \end{enumerate}
  The condition that $\sigma|\Delta^{\{0, 1'\}}$ is $p$-cocartesian corresponds to the condition that the simplex $\tau|\Delta^{\{0,1,\overline{0}\}}$ is left Kan.

  The diagram $\tau$ contains a lot of redundant data, which we would now like to consolidate. We first shuffle some data around our diagram. Applying \hyperref[lemma:transport_left_kan_simplices]{Lemma~\ref*{lemma:transport_left_kan_simplices}} to the simplex $\tau|\Delta^{\{1,2,\overline{1}, \overline{0}\}}$, we see that $\tau|\Delta^{\{1,2,\overline{0}\}}$ is left Kan. Applying \hyperref[lemma:transport_thin_simplices]{Lemma~\ref*{lemma:transport_thin_simplices}} to the simplex $\tau|\Delta^{\{1',2, \overline{1}', \overline{0}\}}$, we see that $\tau|\Delta^{\{1',2, \overline{0}\}}$ is thin.

  We can now study a subdiagram which contains all the information we need. We consider the restriction
  \begin{equation*}
    \tau|\Delta^{\{0,1,2,\overline{0}\}} \amalg_{\Delta\{0,2,\overline{0}\}} \Delta^{\{0,1',2,\overline{0'}\}}.
  \end{equation*}
  This is determined, up to specific choices of compositions, by the diagram
  \begin{equation*}
    \begin{tikzcd}[row sep=large, column sep=large]
      X_{0}
      \arrow[r, "f'"]
      \arrow[d, swap, "g'"]
      & X_{1'}
      \arrow[d, swap, "g"]
      \arrow[r, "F", ""{swap, name=M}]
      & \category{C}
      \\
      X_{1}
      \arrow[r, "f"]
      & X_{2}
      \arrow[ur, swap, "G"]
      \arrow[from=M, Rightarrow, shorten=2ex, swap, "\eta"]
    \end{tikzcd}.
  \end{equation*}
  Here, the square pictured is $\sigma$, and the triangle is $\tau|\Delta^{\{1',2,\overline{0}\}}$.

  Since the simplices $\tau|\Delta^{\{0,1,\overline{0}\}}$ and $\tau|\Delta^{\{1,2, \overline{0}\}}$ are thin, the pasting of the square and the triangle above is homotopic to the restriction $\tau|\Delta^{\{0,1,\overline{0}\}}$. This is the triangle which we wish to show is left Kan. According to \hyperref[lemma:left_kan_ext_along_kan_complexes]{Lemma~\ref*{lemma:left_kan_ext_along_kan_complexes}} it suffices to show that for all $x \in X_{1}$, the pasting diagram
  \begin{equation*}
    \begin{tikzcd}[row sep=large, column sep=large]
      (X_{0})_{/x}
      \arrow[r, "\pi"]
      \arrow[d]
      & X_{0}
      \arrow[r, "f'"]
      \arrow[d, swap, "g'"]
      & X_{1'}
      \arrow[d, swap, "g"]
      \arrow[r, "F", ""{swap, name=M}]
      & \category{C}
      \\
      \{x\}
      \arrow[r, hook]
      & X_{1}
      \arrow[r, "f"]
      & X_{2}
      \arrow[ur, swap, "G"]
      \arrow[from=M, Rightarrow, shorten=2ex, swap, "\eta"]
    \end{tikzcd}
  \end{equation*}
  exhibits $G(f(x))$ as the colimit of $F \circ f' \circ \pi$. But applying the pasting law for homotopy pullbacks, this follows directly from the assumption that $\eta$ exhibits $G$ as a left Kan extension of $F$ along $f$.
\end{proof}


\end{document}
