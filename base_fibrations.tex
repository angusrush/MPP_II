\documentclass[main.tex]{subfiles}

\begin{document}

\section{Monoidal push-pull of local systems}
\label{sec:the_monoidal_construction}

Suppose $p\colon \category{C} \to \category{D}$ is a cartesian fibration of 1-categories which classifies a pseudofunctor $\hat{p}\colon \category{D}\op \to \Cat$. Further suppose the following:
\begin{itemize}
  \item The category $\category{C}$ carries a symmetric monoidal structure $\otimes$.

  \item The category $\category{D}$ carries a symmetric monoidal structure $\boxtimes$.

  \item The functor $p$ is strong monoidal: for $x$, $y \in \category{C}$, $p(x \otimes y) = p(x) \boxtimes p(y)$.\footnote{The reason for the strict equality in this condition is that we have chosen specific monoidal functors $\otimes$ and $\times$. Later, we will replace these functors by fibrations, and the condition of strict equality will be replaced by a more usual one.}

  \item The monoidal product $\otimes$ preserves $p$-cartesian morphisms: if $f$ and $g$ are $p$-cartesian morphisms, then $f \otimes g$ is also $p$-cartesian.
\end{itemize}
Under these conditions, the pseudofunctor $\hat{p}$ carries a lax monoidal structure $(\category{D}\op, \boxtimes) \to (\Cat, \times)$ \cite{moeller2018monoidal}. The structure maps
\begin{equation*}
  \begin{tikzcd}
    \hat{p}(d) \times \hat{p}(d') \to \hat{p}(d \boxtimes d')
  \end{tikzcd}
\end{equation*}
are given by restricting the tensor product $\otimes$ to the fibers over $d$ and $d'$. That these structure maps form a pseudonatural transformation, i.e.\ that the necessary squares commute up to specified homotopy, follows from the assumption that the monoidal product preserves $p$-cartesian morphisms in each slot.

If we want to study covariant rather than contravariant pseudofunctors, we should replace cartesian fibrations by cocartesian fibrations; of course, now we must assume that $\otimes$ preserves cocartesian edges rather than cartesian.

As we saw in the last chapter, we can combine both cartesian and cocartesian functorialities into pull-push functoriality by upgrading our (co)cartesian fibrations to Beck-Chevalley fibrations. Consider a Beck-Chevalley fibration $r\colon \category{X} \to \category{T}$ such that $\category{X}$ carries a symmetric monoidal structure $\otimes$, and $\category{T}$ carries a symmetric monoidal structure $\boxtimes$.\footnote{It turns out that the only monoidal structure that is compatible with the creation of the category of spans is the cartesian monoidal structure, so we may assume without loss of generality that $\boxtimes$ is the cartesian product.} Our first purpose in this chapter is to show that under the assumption that $r$ is strong monoidal, and that $\otimes$ preserves both cartesian and cocartesian edges, one finds that the functor
\begin{equation*}
  \Span(\category{T}) \to \ICat
\end{equation*}
constructed in the previous chapter carries a lax monoidal structure. Note that this statement is by no means original. A generalized version of it is proved in \cite{spectralmackeyfunctors2}. We provide an elementary account of the portions of the theory which we will need.

Like Barwick et al., we will prove a somewhat adapted version of this statement. Note that in the above discussion, we were carrying a conceptual difficulty with us by modelling monoidal categories as tuples, $(\category{C}, \otimes, \dots)$; we have chosen a specific functor $\otimes$, together with specific choices of coherent data surrounding it. It is often preferable to model a symmetric monoidal category as a fibration, leaving these choices unmade, and this is what we will do. As our aim will be to build categories of spans (where we must have good control over pullback squares), we will model our symmetric monoidal categories as cartesian fibrations, rather than the more usual cocartesian fibrations. In \hyperref[ssc:monoidal_beck_chevalley_fibrations]{Subsection~\ref*{ssc:monoidal_beck_chevalley_fibrations}}, we give the basic definitions we will need, culminating in the definition of a monoidal Beck-Chevalley fibration.


\subsection{Monoidal Beck-Chevalley fibrations}
\label{ssc:monoidal_beck_chevalley_fibrations}

\begin{note}
  For this to work out, I think we probably need to modify the second condition to be an adequate triple so that we only need to consider pullbacks of the type given in the first condition.
\end{note}

Our theory of symmetric monoidal $\infty$-categories exactly mirrors Lurie's \cite{luriehigheralgebra}, except that we will use cartesian rather than cocartesian fibrations.

\begin{definition}
  A \defn{CSMC} (contravariantly-presented symmetric monoidal $\infty$-category) is a cocartesian fibration $p\colon \category{O}_{\otimes} \to \Finp\op$ such that the pullback maps $(\rho_{i})^{*}\colon (\category{O}_{ \otimes})_{\langle n \rangle} \to (\category{O}_{ \otimes})_{\langle 1 \rangle}$ are the canonical projections exhibiting $(\category{O}_{ \otimes})_{\langle n \rangle}$ as an $n$-fold product.
\end{definition}

\begin{definition}
  A \defn{map} between CSMCs $\category{C}_{\otimes} \to \Fin\op$ and $\category{D}_{\otimes} \to \Finp\op$ is a functor $r$ making the diagram
  \begin{equation*}
    \begin{tikzcd}
      \category{C}_{\otimes}
      \arrow[rr, "r"]
      \arrow[dr, swap, "q"]
      && \category{D}_{\boxtimes}
      \arrow[dl, "p"]
      \\
      & \Finp\op
    \end{tikzcd}
  \end{equation*}
  commute. We will further make use of the following terminology.
  \begin{itemize}
    \item The map $r$ is a \defn{monoidal functor} if it sends $q$-cartesian morphisms to $p$-cartesian morphisms.

    \item The tensor product $\otimes$ \defn{preserves cartesian (resp.\ cocartesian) edges} if for all $\phi\colon \langle n \rangle \leftarrow \langle m \rangle \in \Finp\op$, the associated functor $\phi^{*}\colon (\category{C}_{\otimes})_{\langle m \rangle} \to (\category{C}_{\otimes})_{\langle n \rangle}$ sends $r$-cartesian (resp.\ cocartesian) morphisms contained in the fiber $(\category{C})_{\langle m \rangle}$ to $r$-cartesian (resp.\ cocartesian) morphisms contained in the fiber $(\category{C}_{\otimes})_{\langle n \rangle}$.
  \end{itemize}
\end{definition}

\begin{lemma}
  Let $p$ and $q$ be CSMCs as below, and let $r$ be an inner fibration such that the diagram
  \begin{equation*}
    \begin{tikzcd}
      \category{C}_{\otimes}
      \arrow[rr, "r"]
      \arrow[dr, swap, "q"]
      && \category{D}_{\boxtimes}
      \arrow[dl, "p"]
      \\
      & \Finp\op
    \end{tikzcd}
  \end{equation*}
  commutes. Then the following are equivalent.
  \begin{enumerate}
    \item The map $r$ is a cartesian fibration.

    \item The map $r$ has the following properties.
      \begin{enumerate}
        \item The restriction $r|\langle 1 \rangle$ is a cartesian fibration.

        \item The map $r$ is a monoidal functor.

        \item The tensor product $\otimes$ preserves cartesian edges.
      \end{enumerate}
  \end{enumerate}
\end{lemma}
\begin{proof}
  Suppose that $r$ is a cartesian fibration. Then $r|\langle 1 \rangle$ is a cartesian fibration because the pullback of a cartesian fibration is again a cartesian fibration. The map $r$ sends $p$-cartesian morphisms to $q$-cartesian morphisms by TODO.

  We now show that c) holds. Consider the following diagram of pullback squares.
  \begin{equation*}
    \begin{tikzcd}
    (\category{C}_{\otimes})_{\langle n \rangle}
    \arrow[r]
    \arrow[d, swap, "r|\langle n \rangle"]
    & \category{C}_{\otimes}
    \arrow[d, "r"]
    \\
    (\category{D}_{\otimes})_{\langle n \rangle}
    \arrow[r]
    \arrow[d, swap, "p|\langle n \rangle"]
    & \category{D}_{\otimes}
    \arrow[d, "p"]
    \\
    \{\langle n \rangle\}
    \arrow[r]
    & \Finp\op
    \end{tikzcd}
  \end{equation*}
  It follows from the dual to \cite[Cor.~4.3.1.15]{highertopostheory}\footnote{Note an unfortunate notational clash: our maps $p$, $q$, and $r$ do not agree with Lurie's.} that a morphism in $(\category{C}_{\otimes})_{\langle n \rangle}$ is $r|\langle n \rangle$-cartesian if and only if its image in $\category{C}_{\otimes}$ is $r$-cartesian.

\end{proof}

\begin{definition}
  A \defn{CSMC} is \defn{cartesian} if for all objects $X$ and $Y$, the canonical maps $X \otimes I \leftarrow X \otimes Y \to I \otimes Y$ exhibit $X \otimes Y$ as the product of $X$ and $Y$.
\end{definition}

\begin{proposition}
  Suppose $\category{T}$ is an $\infty$-category with pullbacks and a terminal object. Then $\category{T}$ is adequate, and there exists a symmetric monoidal category $\Span(\category{T})^{\times} \to \Finp$.
\end{proposition}

\begin{definition}
  A \defn{monoidal Beck-Chevalley fibration} is a commutative diagram
  \begin{equation*}
    \begin{tikzcd}
      \category{X}_{\otimes}
      \arrow[rr, "r"]
      \arrow[dr, swap, "q"]
      && \category{T}_{\times}
      \arrow[dl, "p"]
      \\
      & \Finp\op
    \end{tikzcd}
  \end{equation*}
  with the following characteristics.
  \begin{itemize}
    \item The map $p$ is a cartesian CSMC.

    \item The category $\category{T}$ underlying $\category{T}_{\times}$ admits pullbacks.

    \item The map $q$ is a CSMC.

    \item The map $r$ is a cartesian fibration (hence monoidal).

    \item The functor $r|\langle 1 \rangle$ is a cocartesian fibration.

    \item The functor $r$ obeys the following interchange law: for any diagram
      \begin{equation*}
        \begin{tikzcd}
          \vec{z}
          \arrow[r, "f'"]
          \arrow[d, swap, "g'"]
          & \vec{y}
          \arrow[d, "g"]
          \\
          \vec{y}'
          \arrow[r, "f"]
          & \vec{x}
        \end{tikzcd}
      \end{equation*}
      in $\category{X}_{\otimes}$ whose image in $\category{T}_{\otimes}$ is pullback, and which lies over a square
      \begin{equation*}
        \begin{tikzcd}
          \langle n \rangle
          & \langle n \rangle
          \arrow[l, equals]
          \\
          \langle m \rangle
          \arrow[u, "\phi"]
          & \langle m \rangle
          \arrow[l, equals]
          \arrow[u, swap, "\psi"]
        \end{tikzcd},
      \end{equation*}
      in $\Finp\op$, if $g$ and $g'$ are $r$-cartesian and $f$ is $r$-cocartesian, then $f'$ is $r$-cocartesian.
  \end{itemize}
\end{definition}

\begin{lemma}
  The category $\Finp$ admits finite limits and colimits.
\end{lemma}
\begin{proof}
  The category $\Fin$ of finite sets admits all finite limits and colimits. A finite diagram $j\colon K^{\triangleleft} \to \Finp$ is a limit diagram if and only if the restriction $j|K$ is a limit diagram.

  A diagram $K^{\triangleright} \to \Finp$ is a colimit diagram if and only if the corresponding diagram $\{\ast\} \star (K^{\triangleright}) \to \Fin$ is a colimit diagram.
\end{proof}


\begin{proposition}
  For any lax monoidal Beck-Chevalley fibration as in DEF, there is a diagram
  \begin{equation*}
    \begin{tikzcd}
      \Span'(\category{X})^{\otimes}
      \arrow[rr, "\rho"]
      \arrow[dr, swap, "\varpi"]
      && \Span(\category{T})^{\otimes}
      \arrow[dl, "\pi"]
      \\
      & \Finp
    \end{tikzcd}
  \end{equation*}
  where $\pi$ and $\varpi$ are symmetric monoidal categories and $\rho$ exhibits $\Span'(\category{X})^{\otimes}$ as a $\Span(\category{T})^{\otimes}$-monoidal category. Straightening, one finds a lax monoidal functor
  \begin{equation*}
    \hat{r}\colon (\Span(\category{T}), \widetilde{\times}) \to (\ICat, \times)
  \end{equation*}
  with the following description up to equivalence.
  \begin{itemize}
    \item On objects, the functor $\hat{r}$ sends $t \in \Span(\category{T})$ to the fiber $\category{X}_{t} \in \ICat$
    \item On morphisms, $\hat{r}$ sends a span $t \overset{g}{\leftarrow} s \overset{f}{\to} t'$ to the composition $g^{*} \circ f_{!}\colon \category{X}_{t} \to \category{X}_{t'}$.
  \end{itemize}
\end{proposition}
\begin{proof}
  We will consider the following triples.

  \begin{itemize}
    \item We define a triple structure $\triple{F}$ on $\Finp\op$, where
      \begin{itemize}
        \item $\category{F} = \Finp\op$

        \item $\category{F}\downdag = (\Finp\op)^{\simeq}$

        \item $\category{F}\updag = \Finp\op$
      \end{itemize}

      This is obviously adequate. We note that $\Finp\op$ has pullbacks, and finite limits in general, which is more than we need in this case, but will be useful later.

    \item We define a triple $\triple{T}$ as follows.
      \begin{itemize}
        \item $\category{T} = \category{T}_{\times}$

        \item $\category{T}\downdag = \category{T}_{\times} \times_{\Finp\op}(\Finp\op)^{\simeq}$

        \item $\category{T}\updag = \category{T}_{\times}$
      \end{itemize}

      To see that this is adequate, we first note that $p$ admits relative pullbacks; each fiber admits pullbacks by virtue our assumption that $\category{T}$ admits pullbacks, and the identifications $( \category{T}_{\times} )_{\langle n \rangle} \simeq \category{T}^{n}$. The functoriality coming from $p$ implements products, and therefore commute with pullbacks. Thus, $\category{T}_{\times}$ admits pullbacks, and $p$ preserves pullbacks. This immediately implies that $\triple{T}$ is adequate:
      \begin{enumerate}
        \item Pushouts of this form are simply squares with horizontal morphisms given by equivalences.

        \item Any pullback square lies over a pullback square in $\Finp\op$, so this reduces to the lemma about cartesian morphisms.
      \end{enumerate}

    \item We define a triple structure $\triple{X}$ as follows.
      \begin{itemize}
        \item $\category{X} = \category{X}_{\otimes}$.

        \item $\category{X}\downdag = (\category{X}_{\otimes})_{\Finp\op}(\Finp\op)^{\simeq}$.

        \item $\category{X}\updag$ consists only of $r$-cartesian morphisms.
      \end{itemize}

      One sees that this is adequate, since pullbacks of the necessary form exist by the usual procedure:
      \begin{itemize}
        \item Map the diagram down to $\Finp\op$, take the pullback there.

        \item Take a relative pullback in $\category{T}_{\times}$.

        \item Take an $r$-cartesian lift to produce an $r$-relative pullback in $\category{X}_{\times}$. This lies over a pullback in $\category{T}_{\times}$, hence is a pullback.
      \end{itemize}
  \end{itemize}

  Thus, we have maps of adequate triples
  \begin{equation*}
    \begin{tikzcd}
      \triple{X}
      \arrow[rr]
      \arrow[dr]
      && \triple{T}
      \arrow[dl]
      \\
      & \triple{F}
    \end{tikzcd}
  \end{equation*}
  giving us maps
  \begin{equation*}
    \begin{tikzcd}
      \Span\triple{X}
      \arrow[rr]
      \arrow[dr]
      && \Span\triple{T}
      \arrow[dl]
      \\
      & \Span\triple{F}
    \end{tikzcd}.
  \end{equation*}
  Pulling back along the map $\Finp \to \Span\triple{F}$,
\end{proof}


\subsection{The monoidal twisted arrow category}
\label{ssc:the_monoidal_twisted_arrow_category}

The starting point of our construction is the functor
\begin{equation*}
  \begin{tikzcd}
    \Finp
    \arrow[r, "\ICat^{\times}"]
    & \Cat_{(\infty, 2)}
    \arrow[r, "\Tw"]
    & \ICat
  \end{tikzcd}
\end{equation*}
Note that this gives a monoidal category since $\Tw(\ICat^{n})\cong \Tw(\ICat)^{n}$.

We're not gonna worry too much about where the functor $\Tw$ comes from, just keep notes about what properties we're using. The relative nerve of this functor is a Cartesian fibration $\Tw(\ICat)_{\otimes} \to \Finp\op$ with the following description: an $n$-simplex $\sigma$ corresponding to a diagram
\begin{equation*}
  \begin{tikzcd}
    \Delta^{n}
    \arrow[rr, "\sigma"]
    \arrow[dr, swap, "\phi"]
    && \Tw(\ICat)_{\otimes}
    \arrow[dl, "p'"]
    \\
    & \Finp\op
  \end{tikzcd}
\end{equation*}
corresponds to the data of, for each subset $I \subseteq [n]$ having minimal element $i$, a map
\begin{equation*}
  \tau(I)\colon \Delta^{I} \to \Tw(\ICat)^{i}
\end{equation*}
such that For nonempty subsets $I' \subseteq I \subseteq [n]$, the diagram
\begin{equation*}
  \begin{tikzcd}
    \Delta^{I'}
    \arrow[r]
    \arrow[d, hook]
    & \Tw(\ICat)^{i'}
    \arrow[d]
    \\
    \Delta^{I}
    \arrow[r]
    & \Tw(\ICat)^{i}
  \end{tikzcd}
\end{equation*}
commutes.

\begin{example}
  An object of $\Tw(\ICat)_{\otimes}$ lying over $\langle n \rangle$ corresponds to a collection of functors $\category{C}_{i} \to \category{D}_{i}$, $i \in \langle n \rangle^{\circ}$. We will denote this $\vec{\category{C}} \to \vec{\category{D}}$.
\end{example}

\begin{example}
  A morphism in $\Tw(\ICat)_{\otimes}$ lying over the active map $\langle 1 \rangle \leftarrow \langle 2 \rangle$ in $\Finp\op$ consists\footnote{Here we mean the morphism in $\Finp\op$ corresponding to the active map $\langle 2 \rangle \to \langle 1 \rangle$ in $\Finp$.} of
  \begin{itemize}
    \item A `source' object $F\colon \category{C} \to \category{C}'$

    \item A pair of `target' objects $G_{i}\colon \category{D}_{i} \to \category{D}'_{i}$, $i = 1$, $2$.

    \item A morphism
      \begin{equation*}
        \begin{tikzcd}
          \category{C}
          \arrow[r, "\alpha"]
          \arrow[d, ""{name=L, right}, "F"{left}]
          & \category{D}_{1} \times D_{2}
          \arrow[d, ""{name=R, left}, "G_{1} \times G_{2}"{right}]
          \\
          \category{C}'
          & \category{D}'_{1} \times \category{D}'_{2}
          \arrow[l, "\beta"]
          \arrow[Rightarrow, from=L, to=R, shorten=2ex]
        \end{tikzcd}.
      \end{equation*}
  \end{itemize}

  A morphism of the above form is cartesian if and only if it is thin. A general morphism is cartesian if and only if each component square is thin.
\end{example}

\begin{lemma}
  \label{lemma:triangle_of_cartesian_fibrations}
  Let $\category{C}$ be a small 1-category (and, by abuse of notation, its nerve), let $F$, $G\colon \category{C} \to \SSet$ be functors, and let $\alpha\colon F \Rightarrow G$. Suppose that $\alpha$ satisfes the following conditions.
  \begin{enumerate}
    \item For each object $c \in \category{C}$, $\alpha_{c}\colon F(c) \to G(c)$ is a cartesian fibration.

    \item For each morphism $f\colon c \to d$ in $\category{C}$, the map $Ff\colon F(c) \to F(d)$ takes $\alpha_{c}$-cartesian morphisms to $\alpha_{d}$-cartesian morphisms.
  \end{enumerate}
  Then taking the relative nerve gives a diagram
  \begin{equation*}
    \begin{tikzcd}
      N_{F}(\category{C})
      \arrow[rr, "\rho"]
      \arrow[dr, swap, "\Phi"]
      &&
      N_{G}(\category{C})
      \arrow[dl, "\Gamma"]
      \\
      & \category{C}\op
    \end{tikzcd}
  \end{equation*}
  with the following properties.
  \begin{enumerate}
    \item The maps $\Phi$, $\Gamma$, and $\rho$ are all cartesian fibrations.

    \item The $\rho$-cartesian morphisms in $N_{F}(\category{C})$ admit the following description: a morphism in $N(F)(\category{C})$ lying over a morphim $f\colon d \leftarrow c$ in $\category{C}\op$ consists of a triple $(x, y, \phi)$, where $x \in F(d)$, $y \in F(c)$, and $\phi\colon x \to Ff(y)$. Such a morphism is $\rho$-cartesian if the morphism $\phi$ is $\alpha_{d}$-cartesian.

    \item The map $\rho$ sends $\Phi$-cartesian morphisms in $N_{F}(\category{C})$ to $\Gamma$-cartesian morphisms in $N_{G}(\category{C})$.
  \end{enumerate}
\end{lemma}
\begin{proof}
  We first prove 2. We already know (HTT 3.2.5.11) that $\rho$ is an inner fibration, so in order to prove 2., we need to show that we can solve lifting problems
  \begin{equation*}
    \begin{tikzcd}
      \Lambda^{n}_{n}
      \arrow[r]
      \arrow[d]
      & N_{F}(\category{C})
      \arrow[d]
      \\
      \Delta^{n}
      \arrow[r]
      \arrow[ur, dashed]
      \arrow[dr, swap, "\gamma"]
      & N_{G}(\category{C})
      \arrow[d]
      \\
      & \category{C}\op
    \end{tikzcd},
  \end{equation*}
  where $\Delta^{\{n-1, n\}} \subset \Lambda^{n}_{n}$ is mapped to a cartesian morphism as described above, i.e.\ a triple $(x, y, \phi)$, where $x \in F(\gamma(n-1))$, $y \in F(\gamma(n))$, and $\phi\colon x \to F(\gamma_{n})(y)$ is $\alpha_{\gamma(n-1)}$-cartesian. This is equivalent to solving the lifting problem
  \begin{equation*}
    \begin{tikzcd}
      \Lambda^{n}_{n}
      \arrow[r]
      \arrow[d]
      & F(\gamma(0))
      \arrow[d, "\alpha_{\gamma(0)}"]
      \\
      \Delta^{n}
      \arrow[r]
      \arrow[ur, dashed]
      & G(\gamma(0))
    \end{tikzcd},
  \end{equation*}
  where $\Lambda^{n}_{n}$ is $F(\gamma_{n-1, 0})(\phi)$. But by assumption $F(\gamma_{n-1, 0})(\phi)$ is $\alpha_{\gamma(0)}$-cartesian, so this lifting problem has a solution.

  Now we show Claim 1. The assumption that each $\alpha_{c}$ is a cartesian fibration guarantees that we have enough cartesian lifts, so $\rho$ is indeed a cartesian fibration. The maps $\Phi$ and $\Gamma$ are cartesian fibrations by definition.

  Now we show Claim 3. The $\rho$-cartesian morphisms in $N_{F}(\category{C})$ are pairs $(x, y, \phi)$ as above, where $\phi$ is an equivalence. Claim 3.\ then follows because the functors $\alpha_{c}$ functors map equivalences to equivalences.
\end{proof}


Note that for each $\langle n \rangle \in \Finp\op$ there is a cartesian fibration $\Tw(\ICCat)^{n} \to (\ICat^{n})\op \times \ICat^{n}$, which taken together give a natural transformation $\alpha$ from the functor
\begin{equation*}
  F\colon \Finp \to \ICat;\qquad \langle n \rangle \mapsto \Tw(\ICCat)^{n}
\end{equation*}
to the functor
\begin{equation*}
  G\colon \Finp \to \ICat;\qquad \langle n \rangle \mapsto ( \ICat^{n} )\op \times \ICat^{n}.
\end{equation*}

Because the pointwise product of any number of thin 1-simplices in $\Tw(\ICCat)$ is again a thin 1-simplex in $\Tw(\ICCat)$, the conditions of \hyperref[lemma:triangle_of_cartesian_fibrations]{Lemma~\ref*{lemma:triangle_of_cartesian_fibrations}} are satisfied. Unrolling, we find that $\Tw(\ICCat)_{\otimes}$ admits a forgetful functor to $\TICatCart \times (\TICatCocart)\op$, where
\begin{itemize}
  \item $\TICatCart$ is the relative nerve (as a cartesian fibration) of the functor $\Finp \to \ICat$ giving the cartesian monoidal structure on $\ICat$

  \item $\TICatCocart$ is the \emph{cocartesian} relative nerve of the same,
\end{itemize}
such that each map in the commuting triangle
\begin{equation}
  \label{eq:base_triangle}
  \begin{tikzcd}
    \Tw(\ICat)_{\otimes}
    \arrow[rr]
    \arrow[dr]
    && \TICatCart \times (\TICatCocart)\op
    \arrow[dl]
    \\
    & \Finp\op
  \end{tikzcd}
\end{equation}
is a cartesian fibration.

Because both $\TICatCocart \to \Finp$ and $\ICatCocart \to \Finp$ classify the same functor $\Finp \to \ICat$, they are related by a symmetric monoidal equivalence. Composing a monoidal $\infty$-category $\Finp \to \ICatCocart$ with this symmetric monoidal equivalence gives:

\begin{proposition}
  We can express a symmetric monoidal $\infty$-category as a functor $\Finp \to \TICatCocart$.
\end{proposition}

Fix some monoidal $\infty$-category $\category{C}$ which admits colimits, and such that the monoidal structure preserves colimits in each slot. We can thus define a functor
\begin{equation*}
  \TSCart \to \TICatCart \times (\TICatCocart)\op
\end{equation*}
which is induced by the inclusion $\S \hookrightarrow \ICat$ on the first component, and given by the composition
\begin{equation*}
  \TSCart \to \Finp\op \overset{\category{C}}{\to} (\TICatCocart)\op.
\end{equation*}

Forming the pullback
\begin{equation*}
  \begin{tikzcd}
    \LS(\category{C})_{\otimes}
    \arrow[r]
    \arrow[d, swap, "r"]
    & \Tw(\ICat)_{\otimes}
    \arrow[d]
    \\
    \TSCart
    \arrow[r]
    & \TICatCart \times (\TICatCocart)\op
  \end{tikzcd}
\end{equation*}
gives us a commutative triangle
\begin{equation*}
  \begin{tikzcd}
    \LS(\category{C})_{\otimes}
    \arrow[rr, "r"]
    \arrow[dr, swap, "q"]
    && \TSCart
    \arrow[dl, "p"]
    \\
    & \Finp\op
  \end{tikzcd}.
\end{equation*}

By definition, one sees that the map $p$ is a cartesian fibration, and the $p$-cartesian morphisms in $\TSCart$ are precisely those representing products. Furthermore, because the map $r$ is a pullback of the horizontal map in \hyperref[eq:base_triangle]{Diagram~\ref*{eq:base_triangle}}, we have the following.

\begin{proposition}
  The maps $q$ and $r$ are cartesian fibrations, and a generic morphism
  \begin{equation*}
    \begin{tikzcd}
      \vec{X}
      \arrow[r, "\vec{f}"]
      \arrow[d, ""{name=L, right}, "\vec{\mathcal{F}}"{left}]
      & \vec{Y}
      \arrow[d, ""{name=R, left}, "\vec{\mathcal{G}}"{right}]
      \\
      \vec{\category{C}}
      & \vec{\category{C}}
      \arrow[l, "\otimes"]
      \arrow[Rightarrow, from=L, to=R, shorten=1.5ex]
    \end{tikzcd}
  \end{equation*}
  in $\LS(\category{C})$ is
  \begin{itemize}
    \item $r$-cartesian if each $2$-simplex making up the above diagram is thin.

    \item $q$-cartesian if $\vec{f}$ exhibits the $Y_{i}$ as products of the $X_{i}$, and each $2$-simplex making up the above diagram is thin.
  \end{itemize}
\end{proposition}
One sees immediately that $r$ sends $q$-cartesian morphisms in $\LS(\category{C})_{\otimes}$ to $p$-cartesian morphisms in $\TSCart$, and has the sanity check that for any morphism $f$ in $\LS(\category{C})_{\otimes}$ whose image in $\ICatCart$ is $p$-cartesian, $f$ is $q$-cartesian if and only if it is $r$-cartesian.

\subsection{The triple structures}
\label{ssc:the_triple_structures}

\subsubsection{The triple structure on finite pointed sets}
\label{sss:the_triple_structure_on_finite_pointed_sets}

We define a triple structure $\triple{F}$ on $\Finp\op$, where
\begin{itemize}
  \item $\category{F} = \Finp\op$

  \item $\category{F}\downdag = (\Finp\op)^{\simeq}$

  \item $\category{F}\updag = \Finp\op$
\end{itemize}

\begin{proposition}
  This is an adequate triple structure.
\end{proposition}
\begin{proof}
  Trivial.
\end{proof}

\begin{proposition}
  There is a Joyal equivalence $\Finp \to \Span\triple{F}$.
\end{proposition}

\subsubsection{The triple structure on infinity-categories}
\label{sss:the_triple_structure_on_categories}

We define a triple $\triple{P}$ as follows.
\begin{itemize}
  \item $\category{P} = \TSCart$

  \item $\category{P}\downdag = \TSCart \times_{\Finp\op}(\Finp\op)^{\simeq}$

  \item $\category{P}\updag = \TSCart$
\end{itemize}

\begin{proposition}
  The cartesian fibration $\TSCart \to \Finp\op$ admits relative pullbacks.
\end{proposition}
\begin{proof}
  The fibers clearly admit pullbacks, and the pullback maps commute with pullbacks because products commute with pullbacks.
\end{proof}

\begin{proposition}
  This is an adequate triple structure.
\end{proposition}
\begin{proof}
  It suffices to show that $\TSCart$ admits pullbacks, and that for any pullback square in $\TSCart$ lying over a square
  \begin{equation*}
    \begin{tikzcd}
      \langle n \rangle
      & \langle m \rangle
      \arrow[l]
      \\
      \langle n' \rangle
      \arrow[u, "\phi"]
      & \langle m' \rangle
      \arrow[l]
      \arrow[u, swap, "\simeq"]
    \end{tikzcd}
  \end{equation*}
  in $\TSCart$, the morphism $\phi$ is an isomorphism in $\Finp$. But $\TSCart$ admits relative pullbacks and $\Finp\op$ admits pullbacks, so $p$ preserves pullbacks. (Just take the proof from my thesis!)
\end{proof}

\subsubsection{The triple structure on the twisted arrow category}
\label{sss:the_triple_structure_on_the_twisted_arrow_category}

We define a triple $\triple{Q}$ as follows:
\begin{itemize}
  \item $\category{Q} = \LS(\category{C})_{\otimes}$

  \item $\category{Q}\downdag = \LS(\category{C})_{\otimes} \times_{\Finp\op}(\Finp\op)^{\simeq}$

  \item $\category{Q}\updag$ consists of the subcategory of $\LS(\category{C})_{\otimes}$ of $r$-cartesian morphisms, i.e.\ thin morphisms.
\end{itemize}

These triple constructions correspond to spans of the following form.
\begin{equation*}
  \begin{tikzcd}
    \vec{X}
    \arrow[d, ""{name=L, right}]
    & \vec{Z}
    \arrow[d, ""{name=ML, left}, ""{name=MR, right}]
    \arrow[r]
    \arrow[l]
    & \vec{Y}
    \arrow[d, ""{name=R, right}]
    \\
    \category{C}^{n}
    \arrow[d, no head, dotted, bend left]
    \arrow[r]
    & \category{C}^{m}
    \arrow[d, no head, dotted, bend left]
    & \category{C}^{m}
    \arrow[l, swap, "\simeq"]
    \arrow[d, no head, dotted, bend left]
    \\
    \vec{X}
    \arrow[d, no head, dotted, bend left]
    & \vec{Z}
    \arrow[d, no head, dotted, bend left]
    \arrow[r]
    \arrow[l]
    & \vec{Y}
    \arrow[d, no head, dotted, bend left]
    \\
    \langle n \rangle
    \arrow[r]
    & \langle m \rangle
    & \langle m \rangle
    \arrow[l, swap, "\cong"]
    \arrow[from=ML, to=L, phantom, shorten=1.5ex, "\circlearrowleft"{description}]
    \arrow[from=MR, to=R, Rightarrow, shorten=2ex]
  \end{tikzcd}
\end{equation*}

According to the modified Barwick's theorem, such a span will correspond to a cocartesian morphism in $\Span\triple{P}$ if it is of the form
\begin{equation*}
  \begin{tikzcd}
    \vec{X}
    \arrow[d, "\mathcal{F}"{left}, ""{name=L, right}]
    & \vec{Z}
    \arrow[d, "g^{*}t \circ \mathcal{F}"{description}, ""{name=ML, left}, ""{name=MR, right}]
    \arrow[r, "f"]
    \arrow[l, swap, "g"]
    & \vec{Y}
    \arrow[d, ""{name=R, right}, "f_{!}(g^{*}t\mathcal{F})"]
    \\
    \category{C}^{n}
    \arrow[r]
    & \category{C}^{m}
    & \category{C}^{m}
    \arrow[l, swap, "\cong"]
    \arrow[from=ML, to=L, phantom, shorten=1.5ex, "\circlearrowleft"{description}]
    \arrow[from=MR, to=R, Rightarrow, shorten=2ex]
  \end{tikzcd}.
\end{equation*}
In particular, in the fiber over $\langle 1 \rangle \in \Finp\op$, this is simply pull-push.

%\begin{lemma}
%  Given a square
%  \begin{equation*}
%    \begin{tikzcd}
%      \langle n \rangle
%      & \langle n \rangle
%      \arrow[l, swap, "\simeq"]
%      \\
%      \langle m \rangle
%      \arrow[u]
%      & \langle m \rangle
%      \arrow[l, swap, "\simeq"]
%      \arrow[u]
%    \end{tikzcd}
%  \end{equation*}
%  in $\Finp\op$ and a solid cospan
%  \begin{equation*}
%    \begin{tikzcd}
%      y
%      \arrow[r, dashed]
%      \arrow[d, dashed]
%      & y'
%      \arrow[d, "g"]
%      \\
%      x
%      \arrow[r]
%      & y
%    \end{tikzcd}
%  \end{equation*}
%  lying over it, where $g$ is cartesian, a relative pullback always exists.
%\end{lemma}
%\begin{proof}
%  The fiber of $q$ over $\langle n \rangle \in \Finp\op$ is equivalent to $\LS(\category{C})^{n}$, which admits pullbacks by
%\end{proof}

\begin{proposition}
  The triple $\triple{Q}$ is adequate.
\end{proposition}
\begin{proof}
  We need to show that for any solid diagram in $\LS(\category{C})_{\otimes}$ of the form
  \begin{equation*}
    \begin{tikzcd}
      y
      \arrow[r, dashed, "f'"]
      \arrow[d, swap, dashed, "g'"]
      & y'
      \arrow[d, "g"]
      \\
      x
      \arrow[r, "f"]
      & y
    \end{tikzcd},
  \end{equation*}
  where $g$ is cartesian and $f$ lies over an isomorphism in $\Finp\op$, a dashed pullback exists, and for each such dashed pullback, $g'$ is cartesian and $f'$ lies over an isomorphism in $\Finp\op$. The existence of such a pullback is easy; one takes a pullback in $\Finp\op$, takes a $q$-cartesian lift $g'$, then fills an inner and an outer horn. That this is pullback is immediate because $g$ and $g'$ are $q$-cartesian. That any other pullback square has the necessary properties follows from the existence of a comparison equivalence.
\end{proof}

\subsection{Building categories of spans}
\label{ssc:building_categories_of_spans}

\begin{proposition}
  The map $p$ satisfies the conditions of the original Barwick's Theorem.
\end{proposition}
\begin{proof}
  See thesis.
\end{proof}

\begin{proposition}
  The map $r$ satisifes the conditions of the modified Barwick's Theorem.
\end{proposition}
\begin{proof}
  The first condition is obvious since $r$ is a cartesian fibration. In order to check the second condition, we fix a square $\sigma$ in $\Tw(\category{C})_{\otimes}$, lying over a square $r(\sigma)$ in $\TSCart$ and a square $q(\sigma)$ in $\Finp\op$. Fixing notation, we will let $q(\sigma)$ be the square
  \begin{equation*}
    \begin{tikzcd}
      \langle n \rangle
      & \langle n \rangle
      \arrow[l, swap, "\gamma'"]
      \\
      \langle m \rangle
      \arrow[u, "\tau'"]
      & \langle m \rangle
      \arrow[u, swap, "\tau"]
      \arrow[l, swap, "\gamma"]
    \end{tikzcd},
  \end{equation*}
  where $\gamma$ and $\gamma'$ are isomorphisms.

  The square $r(\sigma)$ thus has the form
  \begin{equation*}
    \begin{tikzcd}
      \vec{X}'
      \arrow[r, "f'"]
      \arrow[d, swap, "g'"]
      & \vec{Y}'
      \arrow[d, "g"]
      \\
      \vec{X}
      \arrow[r, "f"]
      & \vec{Y}
    \end{tikzcd},
  \end{equation*}
  where $f$ has components
  \begin{equation*}
    f_{i}\colon X_{i} \to Y_{\gamma^{-1}(i)},\qquad i \in \langle m \rangle^{\circ},
  \end{equation*}
  $f'$ has components
  \begin{equation*}
    f'_{j}\colon X'_{j} \to Y'_{\gamma'^{-1}(j)},\qquad j \in \langle n \rangle^{\circ},
  \end{equation*}
  $g$ has components
  \begin{equation*}
    g_{j}\colon Y'_{j} \to \prod_{\tau(i) = j} Y_{i},\qquad j \in \langle n \rangle^{\circ},
  \end{equation*}
  and $g'$ has components
  \begin{equation*}
    g'_{j}\colon X'_{j} \to \prod_{\tau'(i) = j} X_{i},\qquad j \in \langle n \rangle^{\circ}.
  \end{equation*}

  Note that the condition that $r(\sigma)$ be pullback is the condition that
  \begin{equation*}
    X'_{j} \simeq Y'_{j} \times_{\left( \prod_{\tau'(i) = j} Y_{i} \right)} \left( \prod_{\tau'(i) = j} X_{i} \right),
  \end{equation*}
  and that the maps $f'_{j}$ and $g'_{j}$ be the canonical projections.

  The data of the square $\sigma$ is thus given by a diagram of the form
  \begin{equation*}
    \begin{tikzcd}
      \vec{X}'
      \arrow[rrr, "f'"]
      \arrow[dr, "g'"]
      \arrow[ddd, swap, "\mathcal{F}'"]
      &&& \vec{Y}'
      \arrow[ddd, near end, "\mathcal{G}'"]
      \arrow[dr, "g"]
      %\arrow[from=R1, to=L2, Rightarrow, shorten=6ex]
      \\
      & \vec{X}
      \arrow[rrr, crossing over, "f"]
      &&& \vec{Y}
      \arrow[ddd, "\mathcal{G}"]
      \\
      \\
      \category{C}^{(n)}
      &&& \category{C}^{(n)}
      \arrow[lll, near start, "\gamma'_{\otimes}"]
      \\
      & \category{C}^{(m)}
      \arrow[ul, "\tau'_{\otimes}"]
      \arrow[from=uuu, crossing over, near start, "\mathcal{F}"]
      &&& \category{C}^{(m)}
      \arrow[lll, "\gamma_{\otimes}"]
      \arrow[ul, "\tau_{\otimes}"]
      %\arrow[from=R1, to=L3, phantom, "\circlearrowleft"{description}]
      %\arrow[from=R3, to=L4, Rightarrow, crossing over, shorten=6ex]
      %\arrow[from=R2, to=L4, phantom, "\circlearrowleft"{description}]
    \end{tikzcd},
  \end{equation*}
  where the left and right faces are thin, the top face is a pullback, the bottom face is a pushout, and the front face is a left Kan extension (i.e.\ each component is a left Kan extension). We need to show that the back face is a left Kan extension, i.e.\ that for each $j \in \langle n \rangle^{\circ}$, the square
  \begin{equation*}
    \begin{tikzcd}
      X'_{j}
      \arrow[r, "f'_{j}"]
      \arrow[d, swap, "\mathcal{F}'_{i}"]
      & Y'_{\gamma^{-1}(j)}
      \arrow[d, "\mathcal{G}'_{\gamma^{-1}(i)}"]
      \\
      \category{C}
      & \category{C}
      \arrow[l, equals]
    \end{tikzcd}
  \end{equation*}
  is left Kan.

  Using HTT 4.3.1.9, we can choose cartesian edges, transporting the pullback square in $\LS(\category{C})_{\otimes}$ above to a pullback square entirely in the fiber over $\langle n \rangle \in \Finp\op$. Since $(\LS(\category{C})_{\otimes})_{\langle n \rangle} \cong (\LS(\category{C}))^{n}$, this diagram consists of $n$ diagrams in $\LS(\category{C})$, one for each $j \in \langle n \rangle^{\circ}$, of the form
  \begin{equation*}
    \begin{tikzcd}
      X'_{j}
      \arrow[rrr, "f'_{j}"]
      \arrow[dr]
      \arrow[ddd, swap, "\mathcal{F}_{i}'"]
      &&& Y'_{\gamma'^{-1}(j)}
      \arrow[ddd, near end, "\mathcal{G}_{\gamma^{-1}(i)}'"]
      \arrow[dr]
      %\arrow[from=R1, to=L2, Rightarrow, shorten=6ex]
      \\
      & \prod_{\tau'(i) = j} X_{i}
      \arrow[rrr, crossing over]
      &&& \prod_{\tau(i) = j} Y_{i}
      \arrow[ddd, "\mathcal{B}"]
      \\
      \\
      \category{C}
      &&& \category{C}
      \arrow[lll, equals]
      \\
      & \category{C}
      \arrow[ul, equals]
      \arrow[from=uuu, crossing over, near start, "\mathcal{A}"]
      &&& \category{C}
      \arrow[lll, equals]
      \arrow[ul, equals]
      %\arrow[from=R1, to=L3, phantom, "\circlearrowleft"{description}]
      %\arrow[from=R3, to=L4, Rightarrow, crossing over, shorten=6ex]
      %\arrow[from=R2, to=L4, phantom, "\circlearrowleft"{description}]
    \end{tikzcd},
  \end{equation*}
  where the top face is pullback, the bottom face is trivially a pushout, and the left and right faces are thin. We want to show that the back face of each of these diagrams is a left Kan extension. If we can show that the front face is a left Kan extension, we will be done. The map $\mathcal{A}$ is the composition of the product of each of the maps $\mathcal{F}_{i}\colon X_{i} \to \category{C}$ with the tensor product $\category{C}^{\abs{\{\tau'(i) = j\}}} \to \category{C}$, and similarly for $\mathcal{B}$. Unravelling the conditions, one finds that the condition that $\category{B}$ be a pointwise left Kan extension of $\category{A}$ along the front-top-horizontal map above is precisely the condition that the tensor product commute with colimits.

  %OLD STUFF HERE

  %Here $\mathcal{F}$ has components
  %\begin{equation*}
  %  \mathcal{F}_{i}\colon X_{i} \to \category{C}_{i}\colon i \in \langle m \rangle^{\otimes}.
  %\end{equation*}

  %Kan extending $\mathcal{F}$ along $f$ we find a map $f_{!}\mathcal{F}\colon \vec{Y} \to \category{C}^{(m)}$, with components
  %\begin{equation*}
  %  (f_{!}\mathcal{F})_{i} \simeq (f_{\gamma(i)})_{!}\mathcal{F}_{\gamma(i)}\colon Y_{i} \to \category{C}_{i}.
  %\end{equation*}
  %Thus, we find that
  %\begin{equation*}
  %  \mathcal{G} \simeq \tau_{\otimes} \circ g^{*}f_{!}\mathcal{F},
  %\end{equation*}
  %with components given by the composition
  %\begin{equation*}
  %  \mathcal{G}_{j}\colon Y'_{j} \to \prod_{\tau(i) = j} Y_{j} \to \prod_{\tau(i) = j} \category{C}_{i} \to \category{C}_{j}.
  %\end{equation*}

  %Alternatively, starting from $\mathcal{F}$ and pulling back along the left face gives a map
  %\begin{equation*}
  %  \tau'_{\otimes} \circ g'^{*}\mathcal{F}
  %\end{equation*}
  %with components
  %\begin{equation*}
  %  (\tau'_{\otimes} \circ g'^{*}\mathcal{F})_{j}\colon X'_{j} \to \prod_{\tau'(i) = j} X_{j} \to \prod_{\tau'(i) = j} \category{C}_{i} \to \category{C}_{j}.
  %\end{equation*}

  %We need to show that
  %\begin{equation*}
  %  \mathcal{G} \simeq f'_{!}(\tau'_{\otimes} \circ g'^{*}\mathcal{F})
  %\end{equation*}
  %or equivalently, componentwise, that
  %\begin{equation*}
  %  \mathcal{G}_{j} \simeq (f'_{\gamma'(j)})_{!}(\tau'_{\otimes} \circ g'^{*}\mathcal{F})_{\gamma'(j)}
  %\end{equation*}
\end{proof}

\section{Constructing the symmetric monoidal functor}
\label{sec:constructing_the_symmetric_monoidal_functor}

The rest of the work follows my thesis pretty much exactly. We are now justified in building
\begin{equation*}
  \begin{tikzcd}
    \Span\triple{Q}
    \arrow[rr]
    \arrow[dr]
    && \Span\triple{P}
    \arrow[dl]
    \\
    & \Span\triple{F}
  \end{tikzcd}.
\end{equation*}

We pull back along $\Finp \overset{\simeq}{\to} \Span\triple{F}$, giving us isofibrations
\begin{equation*}
  \begin{tikzcd}
    P
    \arrow[rr]
    \arrow[dr]
    && Q
    \arrow[dl]
    \\
    & \Finp
  \end{tikzcd},
\end{equation*}
and it is easy to check that each of these maps has enough cocartesian lifts. The functor we are interested is the component of $P \to Q$ lying over $\langle 1 \rangle$; this classifies the functor
\begin{equation*}
  \Span(\S) \to \ICat
\end{equation*}
sending a span of spaces to push-pull, up to an $\op$. Composing with $\op\colon \ICat \to \ICat$ gives precisely the map we want. General abstract nonsense implies that this functor is lax monoidal.

\end{document}
